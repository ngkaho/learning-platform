-- V001__create_student_table.sql
CREATE TABLE IF NOT EXISTS student (
    id VARCHAR(255) PRIMARY KEY,
    last_name VARCHAR(255),
    first_name VARCHAR(255),
    given_name VARCHAR(255),
    chinese_last_name VARCHAR(255),
    chinese_first_name VARCHAR(255),
    phone_number VARCHAR(255),
    date_of_birth TIMESTAMP WITH TIME ZONE,
    sex VARCHAR(255),
    organiser_id VARCHAR(255),
    class_id VARCHAR(255),
    guardian_id VARCHAR(255),
    join_date TIMESTAMP WITH TIME ZONE,
    active BOOLEAN NOT NULL DEFAULT TRUE,
    last_modified_date TIMESTAMP WITH TIME ZONE NOT NULL DEFAULT CURRENT_TIMESTAMP,
    created_date TIMESTAMP WITH TIME ZONE NOT NULL DEFAULT CURRENT_TIMESTAMP
);

-- V002__create_student_profile_table.sql
CREATE TABLE IF NOT EXISTS student_profile (
    id BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    student_id VARCHAR(255) NOT NULL,
    active BOOLEAN NOT NULL DEFAULT TRUE,
    last_modified_date TIMESTAMP WITH TIME ZONE NOT NULL DEFAULT CURRENT_TIMESTAMP,
    created_date TIMESTAMP WITH TIME ZONE NOT NULL DEFAULT CURRENT_TIMESTAMP
);

-- V003__create_topic_mastery_table.sql
CREATE TABLE IF NOT EXISTS topic_mastery (
    id BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    profile_id BIGINT NOT NULL REFERENCES student_profile(id) ON DELETE CASCADE,
    topic_id BIGINT NOT NULL,
    theta DOUBLE PRECISION NOT NULL DEFAULT 0.0,
    mastery_score INTEGER NOT NULL DEFAULT 50,
    active BOOLEAN NOT NULL DEFAULT TRUE,
    last_modified_date TIMESTAMP WITH TIME ZONE NOT NULL DEFAULT CURRENT_TIMESTAMP,
    created_date TIMESTAMP WITH TIME ZONE NOT NULL DEFAULT CURRENT_TIMESTAMP
);